<!DOCTYPE html > 
<html  lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>jQuery Solar Data graph handler</title>
    <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="SDvizStyle3.css">
    <script>

     var DBearliestDate = getDBearliestDate();
     var DBlatestDate = getDBlatestDate();

    $(document).ready(function(){
      // fade up the graph area background
      $('#SDviz').hide();
      $('#SDviz').fadeIn(2000);
    });
    
    $("#SDvalueSetter").mousedown(function() {
        //bind event
      });    

    $("#SDvalueSetter").mouseup(function() {
        //un-bind event
      });
      

      $(function() {
      $( "#SDvalueSetter" ).resizable({
	handles: "e, w",
	containment: "#SDscope",
	resize: function() {
            var $this = $(this);
            var thisPos = $this.position();
            var width = $this.width();
            //var scopewidth = $("#SDscope").parent().width;
            //alert(scopewidth);
            var parentPos = $this.parent().position();
            var x1 = thisPos.left - parentPos.left;
            //console.log(scopewidth);
            //if (x1 >= scopewidth - 80 ) {x1 = scopewidth - 80}
            var x2 = thisPos.left - parentPos.left + width - 80;
            if (x2 <= 0) {x2 = 0};
            $( "#startDate" ).text("start:" + x1);
            $( "#endDate" ).text(" to end: " + x2);
            $( "#startDate" ).parent().css({ position:'relative' });
            $( "#startDate" ).css({left: x1, position:'absolute' });
            $( "#endDate" ).parent().css({ position:'relative' });
            $( "#endDate" ).css({left: x2, position:'absolute' });
        }
      });
    });
    
    $(function() {
      $( "#SDvalueSetter" ).draggable({
	axis: "x",
	containment: "#SDscope",
	drag: function() {
            var $this = $(this);
            var thisPos = $this.position();
            var width = $this.width();
            //var scopewidth = $this.parent().width;
            var parentPos = $this.parent().position();
            var x1 = thisPos.left - parentPos.left;
            //console.log(scopewidth);
            //if (x1 >= scopewidth - 80 ) {x1 = scopewidth - 80}
            var x2 = thisPos.left - parentPos.left + width - 80;
            if (x2 <= 0) {x2 = 0};
            $( "#startDate" ).text("start:" + x1);
            $( "#endDate" ).text(" to end: " + x2);
            $( "#startDate" ).parent().css({ position:'relative' });
            $( "#startDate" ).css({left: x1, position:'absolute' });
            $( "#endDate" ).parent().css({ position:'relative' });
            $( "#endDate" ).css({left: x2, position:'absolute' });
        }
      });
    });
    
    
    function index2dateTime(index){
      //find the database's start timestamp & last record timestamp (extent)
      //find the pixel width of the SDscope (=100%)
      //find proportion of index to SDscope.width and
      //use proportion to calculate and return the timestamp for that 
      //proportion along the database timeline extent
      // MAKE SURE THE TIMESTAMP IS MYSQL SQL COMPATIBLE
       //use global variables DBearliestDate & DBlatestDate
      //timestamp = blah;
      return timestamp;
    }

    function getDBearliestDate(){
      //do a DB lookup for start date.Do this once per session
      //and store results locally
      var SQLearliestQuery = 'SELECT MIN(DT) as EarliestDate FROM DTP;';
      //DBearliestDate = query
      return DBearliestDate;
    }
    
    function getDBlatestDate(){
      //do a DB lookup for latest date.Do this once per session
      //and store results locally
      var SQLlatestQuery = 'SELECT MAX(DT) as LatestDate FROM DTP;';
      //DBlatestDate = query
      return DBlatestDate;
    }
        
    </script>
  </head>
  
  <body>
    <div id='SDviz'></div>
    <div id='SDscope'>
      <div id='SDvalueSetter' class='date'></div>
      <div id='startDate' class='date'>2016-01-04 22:40</div>
      <div id='endDate' class='date'>2016-01-04 22:40</div>
    </div>
  </body>
</html>
